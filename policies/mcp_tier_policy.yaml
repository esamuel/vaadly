# Role/Tier policy for Vaadly MCP tools
# Enforced server-side by the MCP server before tool execution.

version: 1

limits:
  rateLimitsRpm:
    tier1_read: 120
    tier1_write: 60
    tier2_read: 60
    tier2_write: 20
    tier3_read: 30
    tier3_write: 10
  spendCaps:
    # Max auto-approval per operation (currency assumed ILS unless specified)
    tier1_per_op: 5000
    tier2_per_op: 1500
    tier3_per_op: 0
  idempotency:
    required_for_writes: true

access:
  # Tool-level allow/deny by tier; tenancy and role are also checked at runtime.
  tier1:
    allow:
      - getBuilding
      - listUnits
      - getResident
      - listVendors
      - createMaintenanceRequest
      - assignVendor
      - scheduleVisit
      - updateRequestStatus
      - getMaintenanceStats
      - createOwnerVendor
      - createCommitteeVendor
      - createInvoice
      - approveAndPay
      - startVote
      - castVote
  tier2:
    allow:
      - getBuilding
      - listUnits
      - getResident
      - listVendors
      - createMaintenanceRequest
      - assignVendor
      - scheduleVisit
      - updateRequestStatus
      - getMaintenanceStats
      - createCommitteeVendor
      - createInvoice
      - approveAndPay
      - startVote
      - castVote
    deny:
      - createOwnerVendor
  tier3:
    allow:
      - getBuilding
      - getResident   # self only
      - createMaintenanceRequest  # scoped to own unit/building
      - updateRequestStatus       # own requests; only to cancelled
      - castVote
    deny:
      - listUnits
      - listVendors
      - assignVendor
      - scheduleVisit
      - getMaintenanceStats  # full; may receive summarized view via backend mapping
      - createCommitteeVendor
      - createOwnerVendor
      - createInvoice
      - approveAndPay
      - startVote

policies:
  automations:
    tier1:
      auto_assign_vendor: true
      auto_schedule_visit: true
      auto_pay_below_cap: true
    tier2:
      auto_assign_vendor: true
      auto_schedule_visit: true
      auto_pay_below_cap: true
    tier3:
      auto_assign_vendor: false
      auto_schedule_visit: false
      auto_pay_below_cap: false
  approvals:
    # Above these thresholds, require explicit approval (committee for tier2, company for tier1)
    tier1_amount_threshold: 5000
    tier2_amount_threshold: 1500
  logging:
    redactions:
      - paymentMethodId
      - cardNumber
      - cvv
      - email
      - phone
    store_full_inputs: false
    store_full_outputs: false

# Tenancy rules:
# - All requests must include appOwnerId (derived) and buildingId where applicable.
# - Resident (tier3) requests include residentId and are restricted to self.
# - Server enforces these independently of the tool inputs and rejects cross-tenant access.

